{% extends 'myz_base.html' %}

{% load static %}

{% block head %}
    <meta charset="UTF-8">
    <title>MYZ Room</title>
    <meta id="my-data"
          skill_die_url="{% static 'myzdice/Dice/Die_Skill.png' %}"
          neg_skill_url="{% static 'myzdice/Dice/Die_Neg_Skill.png' %}"
    >

{% endblock %}

{% block navbar_space_part_1 %}
<!--exclude space-->
{% endblock %}

{% block brand %}
    <a class="navbar-brand" href="{% url 'vanlevy:home' %}">
        <img src="{% static '/vanlevy/IconReverse_32.png' %}" alt="Van Levy Icon" height="32" width="32">
    </a>

    <a class="navbar-brand">
        <span class="d-inline-block text-truncate room-name" >
            {{room.name}}
        </span>
    </a>

    <a class="navbar-brand" style="color:white;" href="{% url 'myzdice:the_zone' %}">
        <img src="{% static '/myzdice/MutantYearZero_32.png' %}" alt="MYZ Dice Roller" height="32" width="32">
        {% block subtitle %}{% endblock %}
    </a>
{% endblock brand %}

{% block other_navbar_right %}
<a href="{% url 'myzdice:myzroom_info' room_number %}">
    <img src="{% static '/swdice/RoomInfoSmall_32.png' %}" alt="Room Info" height="32" width="32">
    {% block info_label %}
        <span style="font-size: 0.67em; color: white; margin-right: 10px; margin-left: -5px;">
            Info
        </span>
    {% endblock info_label %}
</a>
{% endblock other_navbar_right %}


{% block navbar_space_part_2 %}
<!--exclude space-->
{% endblock %}

{% block body %}

{% load static %}
<div class="container-fluid">
<br>
    {% if not viewing_basic_room %}
    <div class="row no-gutters">
        <div class="col-md-9">
            {% block user_table %}
            {% endblock %}
            {% block gm_stuff %}
            {% endblock %}
        </div>
        <div class="col-md-3">
            {% block room_header %}
            {% endblock %}
        </div>
    </div>
    {% endif %}
    {% block form_inputs %}
    {% if not room.disabled %}
    <form id="destiny" method="POST" autocomplete="off">
        {% csrf_token %}
        <div class="row no-gutters">
            <div class="col-md-9">
                {% block dice_box %}
                <div class="dice-box">
                    <div class="row no-gutters justify-content-start">
                        <div class="col-6 col-md-3 col-lg-2">
                            <table class="dice_table_sml">
                                <tr>
                                    <td>
                                        <img src="{% static 'myzdice/Dice/Die_Base.png' %}" width="40" title="Base Die">
                                        {{ dice_form.num_base_dice }}
                                    </td>
                                    <td>
                                        <button type="button"
                                                onclick="addOne('base')"
                                                class="btn btn-light btn-sm">
                                            &#9650
                                        </button>
                                        <br>
                                        <button type="button"
                                                onclick="subtractOne('base')"
                                                class="btn btn-light btn-sm">
                                            &#9660
                                        </button>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-6 col-md-3 col-lg-2">
                            <table class="dice_table_sml">
                                <tr>
                                    <td>
                                        <img src="{% static 'myzdice/Dice/Die_Skill.png' %}" width="40"
                                             title="Skill Die" id="skill_die">
                                        {{ dice_form.num_skill_dice }}
                                    </td>
                                    <td>
                                        <button type="button"
                                                onclick="addOneSkill()"
                                                class="btn btn-light btn-sm">
                                            &#9650
                                        </button>
                                        <br>
                                        <button type="button"
                                                onclick="subtractOneSkill()"
                                                class="btn btn-light btn-sm">
                                            &#9660
                                        </button>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-6 col-md-3 col-lg-2">
                            <table class="dice_table_sml">
                                <tr>
                                    <td>
                                        <img src="{% static 'myzdice/Dice/Die_Gear.png' %}" width="40" title="Gear Die">
                                        {{ dice_form.num_gear_dice }}
                                    </td>
                                    <td>
                                        <button type="button"
                                                onclick="addOne('gear')"
                                                class="btn btn-light btn-sm">
                                            &#9650
                                        </button>
                                        <br>
                                        <button type="button"
                                                onclick="subtractOne('gear')"
                                                class="btn btn-light btn-sm">
                                            &#9660
                                        </button>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-6 col-md-3 col-lg-2">
                            <table class="dice_table_sml">
                                <tr><td>
                                    <button type="button" id="show_pips_button"
                                                class="btn btn-outline-secondary btn-sm"
                                                onclick="showAutoPips()" style="margin: auto; display: block;">
                                            Show Extras
                                        </button>
                                        <button type="button" id="hide_pips_button"
                                                class="btn btn-outline-secondary btn-sm"
                                                onclick="hideAutoPips()" style="margin: auto; display: none">
                                            Hide Extras
                                        </button>
                                </td></tr>
                            </table>
                        </div>
                        <div class="col-12 col-md-6 col-lg-4">
                            <table class="dice_table_lrg">
                                <tr>
                                    <td>
                                        {{ dice_form.caption }}
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="row no-gutters" id="hidden_fields_1" style="display:none">
                        <div class="col-6 col-md-3 col-lg-2">
                            <table class="dice_table_sml">
                                <tr>
                                    <td>
                                        <img src="{% static 'myzdice/Dice/Auto_Trauma.png' %}" width="40"
                                             title='Automatic Trauma'>
                                        {{ dice_form.additional_trauma }}
                                    </td>
                                    <td>
                                        <button type="button"
                                                onclick="addOne('trauma')"
                                                class="btn btn-light btn-sm">
                                            &#9650
                                        </button>
                                        <br>
                                        <button type="button"
                                                onclick="subtractOne('trauma')"
                                                class="btn btn-light btn-sm">
                                            &#9660
                                        </button>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-6 col-md-3 col-lg-2">
                            <table class="dice_table_sml">
                            <tr>
                                <td>
                                    <img src="{% static 'myzdice/Dice/Auto_Negative_Success.png' %}" width="40"
                                         title='Automatic Negative Success'>
                                    {{ dice_form.additional_failure }}
                                </td>
                                <td>
                                    <button type="button"
                                            onclick="addOne('failure')"
                                            class="btn btn-light btn-sm">
                                        &#9650
                                    </button>
                                    <br>
                                    <button type="button"
                                            onclick="subtractOne('failure')"
                                            class="btn btn-light btn-sm">
                                        &#9660
                                    </button>
                                </td>
                            </tr>
                            </table>
                        </div>
                        <div class="col-6 col-md-3 col-lg-2">
                            <table class="dice_table_sml">
                            <tr>
                                <td>
                                    <img src="{% static 'myzdice/Dice/Auto_Gear_Damage.png' %}" width="40"
                                         title='Automatic Gear Damage'>
                                    {{ dice_form.additional_damage }}
                                </td>
                                <td>
                                    <button type="button"
                                            onclick="addOne('damage')"
                                            class="btn btn-light btn-sm">
                                        &#9650
                                    </button>
                                    <br>
                                    <button type="button"
                                            onclick="subtractOne('damage')"
                                            class="btn btn-light btn-sm">
                                        &#9660
                                    </button>
                                </td>
                            </tr>
                            </table>
                        </div>
                        <div class="col-6 col-md-3 col-lg-2">
                            <table class="dice_table_sml">
                                <tr>
                                    <td>
                                        {{ dice_form.is_pushed }}
                                    </td>
                                    <td>
                                        Check if <em>pushed</em>.
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-12 col-md-6 col-lg-4">
                            <table class="dice_table_lrg">
                                <tr>
                                    <td>
                                        <img src="{% static 'swdice/Dice/D100.png' %}" width="80" title="Numerical Dice">
                                        <span class="big-font"> d</span>
                                        {{ dice_form.numerical_dice_sides }}
                                        {{ dice_form.num_numerical_dice }}
                                    <td>
                                        <button type="button"
                                                onclick="addOne('numerical')"
                                                class="btn btn-light btn-sm">&#9650</button>
                                        <br>
                                        <button type="button"
                                                onclick="subtractOne('numerical')"
                                                class="btn btn-light btn-sm">
                                            &#9660
                                        </button>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="row no-gutters" id="hidden_fields_2" style="display:none">
                        <div class="col-6 col-md-3 col-lg-2">
                            <table class="dice_table_sml">
                            <tr>
                                <td>
                                    <img src="{% static 'myzdice/Dice/Auto_Success_Base.png' %}" width="40"
                                         title='Automatic Success (Base)'>
                                    {{ dice_form.additional_success_base }}
                                </td>
                                <td>
                                    <button type="button"
                                            onclick="addOne('success_base')"
                                            class="btn btn-light btn-sm">
                                        &#9650
                                    </button>
                                    <br>
                                    <button type="button"
                                            onclick="subtractOne('success_base')"
                                            class="btn btn-light btn-sm">
                                        &#9660
                                    </button>
                                </td>
                            </tr>
                            </table>
                        </div>
                        <div class="col-6 col-md-3 col-lg-2">
                            <table class="dice_table_sml">
                            <tr>
                                <td>
                                    <img src="{% static 'myzdice/Dice/Auto_Success_Skill.png' %}" width="40"
                                         title='Automatic Success (Skill)'>
                                    {{ dice_form.additional_success_skill }}
                                </td>
                                <td>
                                    <button type="button"
                                            onclick="addOne('success_skill')"
                                            class="btn btn-light btn-sm">
                                        &#9650
                                    </button>
                                    <br>
                                    <button type="button"
                                            onclick="subtractOne('success_skill')"
                                            class="btn btn-light btn-sm">
                                        &#9660
                                    </button>
                                </td>
                            </tr>
                            </table>
                        </div>
                        <div class="col-6 col-md-3 col-lg-2">
                            <table class="dice_table_sml">
                            <tr>
                                <td>
                                    <img src="{% static 'myzdice/Dice/Auto_Success_Gear.png' %}" width="40"
                                         title='Automatic Success (Gear)'>
                                    {{ dice_form.additional_success_gear }}
                                </td>
                                <td>
                                    <button type="button"
                                            onclick="addOne('success_gear')"
                                            class="btn btn-light btn-sm">
                                        &#9650
                                    </button>
                                    <br>
                                    <button type="button"
                                            onclick="subtractOne('success_gear')"
                                            class="btn btn-light btn-sm">
                                        &#9660
                                    </button>
                                </td>
                            </tr>
                            </table>
                        </div>
                        <div class="col-6 col-md-3 col-lg-2">
                            <table class="dice_table_sml">
                                <tr>
                                    <td>
                                        <img src="{% static 'myzdice/Dice/d6.png' %}" width="40" title="MYZ D6">
                                        {{ dice_form.num_d6 }}
                                    </td>
                                    <td>
                                        <button type="button"
                                                onclick="addOne('d6')"
                                                class="btn btn-light btn-sm">
                                            &#9650
                                        </button>
                                        <br>
                                        <button type="button"
                                                onclick="subtractOne('d6')"
                                                class="btn btn-light btn-sm">
                                            &#9660
                                        </button>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-6 col-md-3 col-lg-2">
                            <table class="dice_table_sml">
                                <tr>
                                    <td>
                                        <img src="{% static 'myzdice/Dice/d66.png' %}" width="40" title="MYZ D66">
                                        {{ dice_form.num_d66 }}
                                    </td>
                                    <td>
                                        <button type="button"
                                                onclick="addOne('d66')"
                                                class="btn btn-light btn-sm">
                                            &#9650
                                        </button>
                                        <br>
                                        <button type="button"
                                                onclick="subtractOne('d66')"
                                                class="btn btn-light btn-sm">
                                            &#9660
                                        </button>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-6 col-md-3 col-lg-2">
                          <table class="dice_table_sml">
                            <tr>
                                <td>
                                    <img src="{% static 'myzdice/Dice/d666.png' %}" width="40" title="MYZ D666">
                                    {{ dice_form.num_d666 }}
                                </td>
                                <td>
                                    <button type="button"
                                            onclick="addOne('d666')"
                                            class="btn btn-light btn-sm">
                                        &#9650
                                    </button>
                                    <br>
                                    <button type="button"
                                            onclick="subtractOne('d666')"
                                            class="btn btn-light btn-sm">
                                        &#9660
                                    </button>
                                </td>
                            </tr>
                          </table>
                        </div>
                    </div>
                    <div class="row no-gutters">
                        <div class="col-12 col-md-6 col-lg-4" style="text-align:center">
                            <table class="dice_table_lrg">
                                <tr>
                                    <td>
                                        <button type="submit" class="btn btn-warning btn-lg"
                                                name="roll_dice" style="margin: auto"
                                                id="roll_dice_button">
                                            <strong>Roll 'Em!</strong>
                                        </button>
                                        <button type="submit" class="btn btn-outline-warning btn-lg"
                                                name="roll_dice_secret" style="margin: auto; display: none;"
                                                id="roll_dice_secret_button">
                                            <strong>Roll 'Em</strong><em>, secretly!</em>
                                        </button>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-12 col-md-6 col-lg-4" style="text-align:center">
                            <table class="dice_table_lrg">
                                <tr>
                                    <td>
                                        <button type="button" id="show_secret_roll_button"
                                                class="btn btn-outline-secondary btn-sm"
                                                onclick="showSecretRoll()" style="display: block; margin: auto;">
                                            Switch to Secret Roll
                                        </button>
                                        <button type="button" id="hide_secret_roll_button"
                                                class="btn btn-outline-secondary btn-sm"
                                                onclick="hideSecretRoll()" style="display: none; margin: auto">
                                            Switch to Regular Roll
                                        </button>
                                        <span id="secret_warning" style="display:none">
                                            {% if player_is_gm %}
                                            <em>As GM, only you will see this roll.</em>
                                            {% else %}
                                            <em>You and the GM will see this roll.</em>
                                            {% endif %}
                                        </span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-12 col-md-6 col-lg-4" style="text-align:center">
                            <table class="dice_table_lrg">
                                <tr>
                                    <td>

                                    </td>
                                    <td>
                                      <div id="push_button">
                                        {% if allow_push %}
                                          <button type="button" id="reset_dice"
                                                class="btn btn-outline-secondary btn-sm"
                                                onclick="resetDice()" style="margin: auto; display: none">
                                            Reset Dice
                                          </button>
                                          <button type="button" id="setup_push"
                                                class="btn btn-outline-success btn-sm"
                                                onclick="setupPush()" style="margin: auto; display: block">
                                            Setup Push
                                          </button>
                                        {% endif %}
                                      </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                {% endblock dice_box %}
            </div>
            <div class="col-md-3">
                {% block player_info %}
                <table style="width: 100%;">
                    <tr>
                        {% if icon %}
                        <td rowspan="2" style="width:90px">
                            <img src="{{ icon }}" width="80">
                        </td>
                        <td>
                            <span style="color:gray">You are signed in as: </span>
                            <br>
                            <strong>{{ name_in_room }}</strong>
                        </td>
                        {% else %}<td colspan="2">
                            <span style="color:gray">You are signed in as: </span>
                            <br>
                            <strong>{{ name_in_room }}</strong>
                        </td>
                        {% endif %}
                    </tr>
                    <tr>
                        <td>
                            <a href="{% url 'myzdice:switch_avatar_room' room_number %}">
                            <button type="button" class="btn btn-light btn-sm" name="switch_avatar">
                                Switch Avatar <strong>&#12299</strong>
                            </button>
                            </a>
                        </td>
                    </tr>
                </table>
                {% endblock player_info %}
                {% block chat_header %}
                <hr>
                <h5>Chat</h5>
                {% endblock chat_header %}
                {% block chat_input %}
                <div class="container-fluid" id="chat_input" style="padding:0">
                    {{ chat_form.chat_text }}
                    {{ chat_form.recipient }}
                    <button type="submit" name="chat" id="chat_submit"
                            class="btn {%if start_whisper%}btn-outline-warning{%else%}btn-outline-dark{%endif%} btn-sm" >
                        {%if start_whisper%}Whisper{%else%}Add Chat{%endif%}
                    </button>
                </div>
                {% endblock chat_input %}
            </div>
        </div>
    </form>
    {% else %}
    <h3>This room has been archived by the GM.</h3>
    <p>No new rolls or chats may be made in it.</p>
    {% endif %}
    {% endblock form_inputs %}
    <div class="row">
        <div class="col-md-9">
            <hr>
            {% block alt_destiny %}
            {% endblock %}
            {% block actions_header %}
            {% endblock actions_header %}
            {% block action_log %}
            <div class="container-fluid" id="action_log" style="padding:0">
                {% if action_log is empty %}
                    <p>This room has no actions.</p>
                {% else %}
                <table id="action_table">
                    <col width="50px">
                    {% for action in action_log %}
                    {% if not action.secret_roll or player_is_gm or action.user == user %}
                    {% if not action.secret_roll %}
                        <tr>
                    {% elif action.user == user %}
                        <tr style="background-color:#fff3a2;">
                    {% else %}
                        <tr style="background-color:#fff372;">
                    {% endif %}
                        {% if action.is_just_caption %}
                            <td>
                            {% if action.image_url %}
                                <img src="{{ action.image_url }}"
                                     title="{{ action.user.username }} as {% if action.avatar %}{{ action.avatar.avatar_name }}{% else %}theirself{% endif %}"
                                     width="40">
                            {% endif %}
                            </td>
                            <td>
                                {% if action.secret_roll %}
                                <em>secret roll</em><br>
                                {% endif %}
                                <strong>{% if action.avatar %}{{ action.avatar.avatar_name }}{% else %}
                                    {{ action.user.username }}{% endif %}</strong>:
                            {{ action.caption }}
                            </td>
                        {% else %}
                            <td>
                            {% if action.image_url %}
                                <img src="{{ action.image_url }}"
                                     title="{{ action.user.username }} as {% if action.avatar %}{{ action.avatar.avatar_name }}{% else %}theirself{% endif %}"
                                     width="40">
                            {% endif %}
                            </td>
                            <td>
                            {% if action.secret_roll %}
                            <em>secret roll</em><br>
                            {% endif %}
                                <p style="padding: 0px; margin: 6px;">
                            <strong>{% if action.avatar %} {{ action.avatar.avatar_name }} {% else %}
                                    {{ action.user.username }} {% endif %} </strong>
                            {% if action.holdover_faces %}
                              Kept:
                                <!--Individual Faces-->
                              {% for face in action.holdover_faces|split_string %}
                                {% if face %}
                                {% with 'myzdice/Faces/'|add:face|add:'.png' as face_image %}
                                <img src="{% static face_image %}" title="{{face}}" width="32px">
                                {% endwith %}
                                {% endif %}
                              {% endfor %}
                            {% endif %}
                            Rolled:
                                <!--Individual Faces-->
                            {% for face in action.faces_summary|split_string %}
                                {% if face %}
                                {% with 'myzdice/Faces/'|add:face|add:'.png' as face_image %}
                                <img src="{% static face_image %}" title="{{face}}" width="32px">
                                {% endwith %}
                                {% endif %}
                            {% endfor %}

                                </p>
                                <p style="padding: 0px; margin: 6px;">

                            {% if action.results_success > 0 %}
                                <strong>Succeeds with: </strong>
                                {% for i in action.results_success|get_range %}
                                <img src="{% static 'myzdice/Results/success.png' %}"
                                     title="{{action.results_success}} Success" width="32px">
                                {% endfor %}
                            {% else %}
                                {% if action.num_base_dice > 0 or action.num_skill_dice != 0 or action.num_gear_dice > 0 %}
                                    <strong>Fails </strong>
                                {% endif %}
                            {% endif %}
                            {% if action.results_failure > 0 %}
                                <strong>with: </strong>
                                {% for i in action.results_failure|get_range %}
                                <img src="{% static 'myzdice/Results/neg_suc.png' %}"
                                     title="{{action.results_failure}} Negative Success" width="32px">
                                {% endfor %}
                            {% endif %}
                            {% if action.results_trauma > 0 %}
                                <strong>Suffers: </strong>
                                {% for i in action.results_trauma|get_range %}
                                <img src="{% static 'myzdice/Results/trauma.png' %}"
                                     title="{{action.results_trauma}} Trauma" width="32px">
                                {% endfor %}
                            {% endif %}
                            {% if action.results_damage > 0 %}
                                <strong>Damages Gear: </strong>
                                {% for i in action.results_damage|get_range %}
                                <img src="{% static 'myzdice/Results/damage.png' %}"
                                     title="{{action.results_damage}} Gear Damage" width="32px">
                                {% endfor %}
                            {% endif %}

                            {% if action.num_numerical_dice > 0 or action.num_d6_dice > 0 or action.num_d66_dice > 0 or action.num_d666_dice > 0 %}
                                <strong>Rolls: </strong>
                            {% endif %}
                            {% if action.results_d6 %}
                                {% for number in action.results_d6|split_string %}
                                    {% if number %}
                                        <div style="border-style: solid; border-color: black; border-width: 1px;
                                            display: inline-block; margin: 5px; padding: 2px; width: 32px; height: 32px;
                                            background-color: #474F8D; color: white; text-align: center;">
                                            {{ number }}
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            {% endif %}

                            {% if action.results_d66 %}
                                {% for number in action.results_d66|split_string %}
                                    {% if number %}
                                        <div style="border-style: solid; border-color: black; border-width: 1px;
                                            display: inline-block; margin: 5px; padding: 2px; width: 40px; height: 32px;
                                            background-color: #121961; color: white; text-align: center;">
                                            {{ number }}
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            {% endif %}

                            {% if action.results_d666 %}
                                {% for number in action.results_d666|split_string %}
                                    {% if number %}
                                        <div style="border-style: solid; border-color: black; border-width: 1px;
                                            display: inline-block; margin: 5px; padding: 2px; width: 48px; height: 32px;
                                            background-color: #0B1044; color: white; text-align: center;">
                                            {{ number }}
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            {% endif %}

                            {% if action.results_numerical %}
                                {% for number in action.results_numerical|split_string %}
                                    {% if number %}
                                        (
                                        <span style="border-style: solid; border-color: black; border-width: 1px;
                                            display: inline; margin: 5px; padding: 2px; width: 40px; height: 40px;">
                                            {{ number }}
                                        </span>
                                        /
                                        <span style="border-style: groove; border-color: black; border-width: 1px;
                                            display: inline; margin: 5px; padding: 2px; width: 40px; height: 40px;
                                            border-radius: 10px">
                                          d {{ action.numerical_dice_sides }}
                                        </span>
                                        )
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                            {% if action.results_cancel %}
                                <em>All dice have cancelled.</em>
                            {% endif %}
                                </p>
                            {% if action.caption %}
                                <p style="padding: 0px; margin: 6px;">
                                <strong>Caption: </strong>
                                {{ action.caption }}
                                </p>
                            {% endif %}
                            </td>
                        {% endif %}
                    </tr>
                    {% endif %}
                    {% endfor %}
                </table>
                {% endif %}
            </div>
            {% endblock action_log %}
        </div>
        <div class="col-md-3" style="padding:0;">
            {% block alt_chat_header %}
            {% endblock %}
            {% block chat_log %}
            <div class="container-fluid" id="chat_log" style="padding:0">
            <hr>
            {% block glossary %}
                <input type="checkbox" id="showblock">
                <div id="slideout">
                    <label id="slideout_tab" for="showblock" title="Dice Meanings">
                        <i>Dice</i>
                    </label>
                    <div id="slideout_inner">
                        <p style="color: white; margin-left: 45px;"><strong>Glossary</strong></p>
                        <ul style="list-style-type:none; color: white; margin-left: -10px;">
                            <li><img src="{% static 'myzdice/Dice/Die_Base.png' %}" width="32" title="Base Die"> Base</li>
                            <li><img src="{% static 'myzdice/Dice/Die_Skill.png' %}" width="32" title="Skill Die"> Skill</li>
                            <li><img src="{% static 'myzdice/Dice/Die_Neg_Skill.png' %}" width="32" title="Negative Skill Die"> Negative Skill</li>
                            <li><img src="{% static 'myzdice/Dice/Die_Gear.png' %}" width="32" title="Gear_Die"> Gear</li>
                            <li><img src="{% static 'myzdice/Dice/d6.png' %}" width="32" title="D6"> D6</li>
                            <li><img src="{% static 'myzdice/Dice/d66.png' %}" width="32" title="D66"> D66</li>
                            <li><img src="{% static 'myzdice/Dice/d666.png' %}" width="32" title="D666"> D666</li>
                            <li><img src="{% static 'swdice/Dice/D100.png' %}" width="32" title="Numerical"> Numerical</li>
                        </ul>
                    </div>
                </div>
                <input type="checkbox" id="showblock2">
                <div id="slideout2">
                    <label id="slideout_tab2" for="showblock2" title="Result Meanings">
                        <i>Pips </i>
                    </label>
                    <div id="slideout_inner2">
                        <p style="color: white; margin-left: 45px;"><strong>Glossary</strong></p>
                        <ul style="list-style-type:none; margin-left: -20px;">
                          <li><img src="{% static 'myzdice/Results/success.png' %}"
                                   width="24" title="Success"> Success -
                              <span style="font-size: 0.8em;">Found on Base, Skill, or Gear dice</span>
                          </li>
                          <li><img src="{% static 'myzdice/Results/trauma.png' %}"
                                   width="24" title="Trauma"> Trauma -
                              <span style="font-size: 0.8em;">Wound to stat used for base dice</span>
                          </li>
                          <li><img src="{% static 'myzdice/Results/damage.png' %}"
                                   width="24" title="Damage"> Damage -
                              <span style="font-size: 0.8em;">Reduces Gear/Armor Bonus</span>
                          </li>
                          <li><img src="{% static 'myzdice/Results/neg_suc.png' %}"
                                   width="24" title="Negative Success"> Negative Success
                              <span style="font-size: 0.8em;">
                              Only found on Negative Skill Dice; cancels a Success</span>
                          </li>
                        </ul>
                    </div>
                </div>
            {% endblock glossary %}
            {% if chat_log is empty %}
                <p>This room has no chats</p>
            {% else %}
                <table id="chat_table">
                    <col width="50px">
                {% for chat in chat_log %}
                    {% if chat.is_private %}
                        {% if chat.recipient == user %}
                            <tr>
                                <td>
                                {% if chat.image_url %}
                                    <img src="{{ chat.image_url }}"
                                         title="{{ chat.user.username }} as {% if chat.avatar %}{{ chat.avatar.avatar_name }}{% else %}theirself{% endif %}"
                                         width="40">
                                {% endif %}
                                </td>
                                <td style="background-color:#fff372;">
                                    {% if chat.avatar %}
                                    <em>{{ chat.avatar.avatar_name }} whispers to you:</em>
                                    {% else %}
                                    <em>{{ chat.user.username }} whispers to you:</em>
                                    {% endif %}
                                    <br>{{chat.chat_text}}
                                </td>
                            </tr>
                        {% elif chat.user == user %}
                            <tr>
                                <td>
                                {% if chat.image_url %}
                                    <img src="{{ chat.image_url }}"
                                         title="{{ chat.user.username }} as {% if chat.avatar %}{{ chat.avatar.avatar_name }}{% else %}theirself{% endif %}"
                                         width="40">
                                {% endif %}
                                </td>
                                <td style="background-color:#fff3a2;">
                                    <em>You whisper to
                                        {% if chat.recipient_avatar %}
                                            {{ chat.recipient_avatar.avatar_name }}:
                                        {% else %}
                                        {{ chat.recipient.username }}:</em>
                                    {% endif %}
                                    <br>{{chat.chat_text}}
                                </td>
                            </tr>
                        {% endif %}
                    {% else %}
                        <tr>
                            <td>
                            {% if chat.image_url %}
                                <img src="{{ chat.image_url }}"
                                     title="{{ chat.user.username }} as {% if chat.avatar %}{{ chat.avatar.avatar_name }}{% else %}theirself{% endif %}"
                                     width="40">
                            {% else %}
                                {% if chat.avatar %}
                                <div class="container-fluid" style="overflow: hidden; max-height: 70px; margin: 0px; padding: 0px;">
                                    <span style="width:40px; word-wrap:break-word; display:inline-block;">
                                    <strong>{{ chat.avatar.avatar_name }}</strong></span>
                                    {% else %}
                                    <span style="width:40px; word-wrap:break-word; display:inline-block;">
                                    <strong>{{ chat.user.username }}</strong></span>
                                    {% endif %}
                                </div>
                            {% endif %}
                            </td>
                            <td>
                                {{chat.chat_text}}
                            </td>
                        </tr>
                    {% endif %}
                {% endfor %}
                </table>
            {% endif %}
            </div>
            {% endblock %}
            {% block page_updates %}
            <div class="container-fluid" id="last_times">
                <p style="display: none">Last action taken: <span id="actionTime">{{ update_times.action.isoformat }}</span></p>
                <p style="display: none">Last chat made: <span id="chatTime">{{ update_times.chat.isoformat }}</span></p>
            </div>
            <div class="container-fluid">
                <p style="display: none">Page last updated: <span id="updateTime"></span></p>
            </div>

            {% endblock %}
        </div>
    </div>
</div>

{% block page_scripts %}
<script>
$(function () {
    var dt = new Date();
    document.getElementById('updateTime').innerText = dt.toISOString();
    update_times();
});
</script>
<script>
function showAutoPips() {
    document.getElementById('hidden_fields_1').style.display='flex';
    document.getElementById('hidden_fields_2').style.display='flex';
    document.getElementById('show_pips_button').style.display='none';
    document.getElementById('hide_pips_button').style.display='block';
};
function hideAutoPips() {
    document.getElementById('hidden_fields_1').style.display='none';
    document.getElementById('hidden_fields_2').style.display='none';
    document.getElementById('show_pips_button').style.display='block';
    document.getElementById('hide_pips_button').style.display='none';
};
function showSecretRoll() {
    document.getElementById('secret_warning').style.display='block';
    document.getElementById('show_secret_roll_button').style.display='none';
    document.getElementById('hide_secret_roll_button').style.display='block';
    document.getElementById('roll_dice_button').style.display='none';
    document.getElementById('roll_dice_secret_button').style.display='block';
};
function hideSecretRoll() {
    document.getElementById('secret_warning').style.display='none';
    document.getElementById('show_secret_roll_button').style.display='block';
    document.getElementById('hide_secret_roll_button').style.display='none';
    document.getElementById('roll_dice_button').style.display='block';
    document.getElementById('roll_dice_secret_button').style.display='none';
};
</script>
<script>
function addOne(id) {
    document.getElementById(id).stepUp(1);
};
function subtractOne(id) {
    document.getElementById(id).stepDown(1);
};
</script>
<script>
function changeSkillImage() {
    var skill_dice = document.getElementById('skill').value;
    var skill_url = "{% static 'myzdice/Dice/Die_Skill.png' %}";
    var negsk_url = "{% static 'myzdice/Dice/Die_Neg_Skill.png' %}";
    if (skill_dice < 0) {
        document.getElementById('skill_die').src = negsk_url;
    } else {
        document.getElementById('skill_die').src = skill_url;
    };
};
function addOneSkill() {
    document.getElementById('skill').stepUp(1);
    changeSkillImage();
};
function subtractOneSkill() {
    document.getElementById('skill').stepDown(1);
    changeSkillImage();
};
function resetDice() {
    document.getElementById('base').value = 0;
    document.getElementById('skill').value = 0;
    document.getElementById('gear').value = 0;
    document.getElementById('d6').value = 0;
    document.getElementById('d66').value = 0;
    document.getElementById('d666').value = 0;
    document.getElementById('is_pushed').checked = false;
    document.getElementById('numerical').value = 0;
    document.getElementById('sides').value = 100;
    document.getElementById('trauma').value = 0;
    document.getElementById('failure').value = 0;
    document.getElementById('damage').value = 0;
    document.getElementById('success_base').value = 0;
    document.getElementById('success_skill').value = 0;
    document.getElementById('success_gear').value = 0;
    document.getElementById('reset_dice').style.display='none';
    document.getElementById('setup_push').style.display='block';
    changeSkillImage();
};
function setupPush() {
    document.getElementById('base').value = {{ push_base }};
    document.getElementById('skill').value = {{ push_skill }};
    document.getElementById('gear').value = {{ push_gear }};
    document.getElementById('is_pushed').checked = true;
    document.getElementById('trauma').value = {{ push_trauma }};
    document.getElementById('failure').value = {{ push_neg_suc }};
    document.getElementById('damage').value = {{ push_damage }};
    document.getElementById('success_base').value = {{ push_base_suc }};
    document.getElementById('success_skill').value = {{ push_skill_suc }};
    document.getElementById('success_gear').value = {{ push_gear_suc }};
    document.getElementById('reset_dice').style.display='block';
    document.getElementById('setup_push').style.display='none';
    changeSkillImage();
};
</script>
<script>
function highlightChat() {
  var number = document.getElementById("id_recipient").selectedIndex;
  var button = document.getElementById("chat_submit");
  var chat_area = document.getElementById("chat_text");
  if (number > 0) {
    button.classList.remove('btn-outline-dark');
    button.classList.add('btn-outline-warning');
    button.textContent = 'Whisper';
    chat_area.classList.add('chat_whisper');
    chat_area.classList.remove('chat_regular');
  } else {
    button.classList.remove('btn-outline-warning');
    button.classList.add('btn-outline-dark');
    button.textContent = 'Add Chat';
    chat_area.classList.remove('chat_whisper');
    chat_area.classList.add('chat_regular');
  };
};
</script>
<script>
$(function () {
  var number = document.getElementById("id_recipient").selectedIndex;
  var button = document.getElementById("chat_submit");
  var chat_area = document.getElementById("chat_text");
  if (number > 0) {
    chat_area.classList.add('chat_whisper');
    chat_area.classList.remove('chat_regular');
  };
});
</script>
<script>
var myForm = $("#destiny");
myForm.submit(function(){
    myForm.submit(function(){
        return false;
    });
});
var mySecondForm = $("#dice");
mySecondForm.submit(function(){
    mySecondForm.submit(function(){
        return false;
    });
});
var myThirdForm = $("#chat");
myThirdForm.submit(function(){
    myThirdForm.submit(function(){
        return false;
    });
});
</script>
<script>
function refresh_action_log(){
    var url_actions = document.URL + ' #action_log';
    var url_destiny = document.URL + ' #destiny_box';
    var url_push_button = document.URL + ' #push_button';
    $('#action_log').load(url_actions);
    $('#destiny_box').load(url_destiny);
    $('#push_button').load(url_push_button);
};
function refresh_chat_log() {
    var url_chat_log = document.URL + ' #chat_log';
    $('#chat_log').load(url_chat_log);
};
function check_and_update() {
    var pageUpdate = new Date(document.getElementById('updateTime').innerText);
    var actionUpdate = new Date($("#actionTime").text());
    var chatUpdate = new Date($("#chatTime").text());
    var now = new Date();
    if (actionUpdate > pageUpdate && chatUpdate > pageUpdate) {
        refresh_action_log();
        refresh_chat_log();
        document.getElementById('updateTime').innerText = now.toISOString();
    } else if (actionUpdate > pageUpdate) {
        refresh_action_log();
        document.getElementById('updateTime').innerText = now.toISOString();
    } else if (chatUpdate > pageUpdate) {
        refresh_chat_log();
        document.getElementById('updateTime').innerText = now.toISOString();
    };
};
function update_times() {
    var url_action_time = document.URL + ' #last_times';
    $('#last_times').load(url_action_time, function () {
        // When it loads, schedule the next request for 1s later
        setTimeout(update_times, 1000)
    });
    check_and_update();
};
</script>
{% endblock page_scripts %}
{% endblock body %}