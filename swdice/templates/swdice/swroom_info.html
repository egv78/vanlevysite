{% extends 'swdice/swroom.html' %}

{% block head %}
    <meta charset="UTF-8">
    <title>SW Room Info</title>
{% endblock %}

{% block brand %}
{% load static %}
    <a class="navbar-brand" href="{% url 'vanlevy:home' %}">
        <img src="{% static '/vanlevy/IconReverse_32.png' %}" alt="Van Levy Icon" height="32" width="32">
    </a>
<span class="d-inline-block text-truncate" style="max-width: 700px; color:white; font-size: 150%; margin-right: 10px;">
    {{room.name}}
</span>
<a class="navbar-brand" style="color:white;" href="{% url 'swdice:dockingbay' %}">
    <img src="{% static '/vanlevy/droid_background_32.png' %}" alt="SW Dice Roller" height="32" width="32">
    {% block subtitle %}{% endblock %}
</a>
<span class="d-inline-block" style="color:white; font-size: 150%;"> Info Page </span>
{% endblock %}

{% block other_navbar_right %}
{% endblock %}

{% load static %}

{% block user_table %}
<div class="container" id="current_users">
    <h5>Player Information Table</h5>
    <table id="users_table" style="100%">
        <tr>
            <th style="width:80px">User <br>Image</th>
            <th style="width:300px">&nbsp<br>Playing as</th>
            <th style="width:80px">Avatar <br>Image</th>
            <th style="width:80px">&nbsp<br>Role</th>
            {% if player_is_gm %}
            <th style="width:180px">Player <br>Info</th>
            {% endif %}
        </tr>
        {% for player in users_in_room %}
        {% if not player.banned or player_is_gm %}
        <tr>
            <td>
                {% if player.user_id.userprofile.user_url_image %}
                    <img src="{{ player.user_id.userprofile.user_url_image }}" width="40">
                {% else %}
                    <em>no image</em>
                {% endif %}
            </td>
            <td>
                <strong>{{ player.user_id.username }}</strong> playing as:
                <strong>
                    {% if player.avatar_id %}{{ player.avatar_id.avatar_name }}{% else %}theirself{% endif %}
                </strong>
            </td>
            <td>
                {% if player.avatar_id %}
                    {% if player.avatar_id.avatar_url_image %}
                        <img src="{{ player.avatar_id.avatar_url_image }}" width="40">
                    {% else %}
                        <em>no image</em>
                    {% endif %}
                {% else %}
                    {% if player.user_id.userprofile.user_url_image %}
                        <img src="{{ player.user_id.userprofile.user_url_image }}" width="40">
                    {% else %}
                        <em>no image</em>
                    {% endif %}
                {% endif %}
            </td>
            <td>
                {% if player.banned %}<em>banned</em>
                {% elif player.game_master %}<strong>GM</strong>
                {% else %}Player
                {% endif %}
            </td>
            {% if player_is_gm %}
            <td>
                <a href="{% url 'swdice:swroom_player_info' room_number player.user_id_id%}">
                <button type="button" class="btn btn-info btn-sm btn-outline-info" name="Player_Info">
                    Player Info
                </button>
                </a>
            </td>
            {% endif %}
        </tr>
        {% endif %}
        {% endfor %}
    </table>
</div>
{% endblock %}

{% block gm_stuff %}
{% if player_is_gm %}
    <div class="container-fluid" id="gm_message">
        <div class="row">
            <div class="col">
                <h5>GM-only Information:</h5>
            </div>
        </div>
        <div class="row no-gutters">
            <div class="col-md-6">
                <h6>Room Details</h6>
                <ul style="margin-left: -15px; margin-top: -5px">
                    <li><strong>Room ID:</strong> <u>{{room.id}}</u></li>
                    {% if not room.open_to_all %}
                    <li><strong>Passcode:</strong>
                        {% if room.passcode %}
                            "{{ room.passcode }}"
                        {% else %}
                            this room's passcode has been left <em>blank</em>.
                        {% endif %}
                    </li>
                    {% else %}
                    <li>This room is <strong>open to all</strong></li>
                    {% endif %}
                    <li><strong>Direct Link:</strong> {% url 'swdice:swroom' room_number %}direct/{% if room.open_to_all %}open{% else %}{{ room.passcode}}{% endif %}</li>
                    <li><strong>Created on:</strong> {{ room.created_on }}</li>
                    <li><strong>Created by:</strong> {{ room.created_by.username }}</li>
                </ul>
            </div>
            <div class="col-md-6">
                {% if room.disabled %}
                <h5><span style="color: darkred;">This room has been <strong>archived</strong>.</span></h5>
                <p>
                    No rolls or chats can be made in this room. On the Docking Bay page, this room is only visible on the
                    Archived Rooms tab.
                </p>
                {% else %}
                <p>
                    As GM, you can choose to <em>archive</em> this room.<br>
                    Once a room has been <em>archived</em>, players will not be able to make any more rolls or chats, and
                    the room will only be visible on the Archived Rooms tab on the Docking Bay page.
                </p>
                {% endif %}
                <div class="row no-gutters" id="disable_button" style="padding: 0px 3px">
                    <div class="col-sm-3">
                      {% if room.disabled %}
                        <button type="button" class="btn btn-sm btn-outline-warning" id="restore"
                                onclick="showRestore()">
                        Restore Room?
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-warning" id="cancel_restore"
                                style="display:none" onclick="hideRestore()">
                        Cancel
                        </button>
                      {% else %}
                        <button type="button" class="btn btn-sm btn-outline-danger" id="disable"
                                onclick="showDisable()">
                        Archive Room?
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-danger" id="cancel_disable"
                                style="display:none" onclick="hideDisable()">
                        Cancel
                        </button>
                      {% endif %} <!--archive/restore button -->
                    </div>
                    <div class="col-sm-9">
                        <div class="container-fluid" id="are_you_sure" style="display: none;">
                            {% if room.disabled %}
                                Are you sure you want to RESTORE this room?
                                <form id="restore_form" method="POST">
                                {% csrf_token %}
                                    <button type="submit" class="btn btn-warning" name="restore_real">
                                        <strong>Yes. RESTORE this room.</strong>
                                    </button>
                                </form>
                            {% else %}
                                Are you sure you want to ARCHIVE this room?
                                <form id="archive_form" method="POST">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-danger" name="archive_real">
                                        <strong>Yes. ARCHIVE this room..</strong>
                                    </button>
                                </form>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endif %}
{% endblock %}

{% block room_header %}
<div class="container-fluid" style="background-color: #B5D4EF">
    <h4>This page does not automatically update.</h4>
    <p>You must manually refresh to see changes to destiny, new rolls, or new chats.</p>
    <p>
        However, this page loads <em>all</em> actions and chats, while the main page shows only the 100 most
        recent actions and 100 most recent chats.
    </p>
    <a href="{% url 'swdice:swroom' room_number %}">
    <button type="button" class="btn btn-info align-right" name="back to page">
        <strong>&#12298</strong> Back to Live Page
    </button>
    </a>
</div>
{% endblock %}

{% block form_inputs %}
<!-- remove inputs, destiny, and standard user information space -->
{% endblock %}

{% block alt_destiny %}
    <div class="container-fluid" id="destiny_area">
        <h5>Current Destiny</h5>
        <table id="destiny_table">
            <tr>
                <td>
                    <span class="container-fluid" id="destiny_box">
                    {% if dark_pips == 0  and light_pips == 0 %}
                    There are no Destiny Points
                    {% endif %}
                    {% for i in dark_pips|get_range %}
                        <img src="{% static 'swdice/Pips/black.png' %}" width="40" title="Use Dark">
                    {% endfor %}
                    {% for i in light_pips|get_range %}
                        <img src="{% static 'swdice/Pips/white.png' %}" width="40" title="Use Light">
                    {% endfor %}
                    </span>
                </td>
            </tr>
        </table>
    </div>
{% endblock %}
{% block actions_header %}
<hr>
<h5>Actions</h5>
{% endblock %}

{% block alt_chat_header %}
<hr>
<h5>Chats</h5>
{% endblock %}
{% block glossary %}
<!-- hide glossary -->
{% endblock%}
<!-- include block chat_log -->


{% block page_scripts %}
<script>
function showRestore() {
    document.getElementById('restore').style.display='none';
    document.getElementById('cancel_restore').style.display='block';
    document.getElementById('are_you_sure').style.display='block';
}
function hideRestore() {
    document.getElementById('restore').style.display='block';
    document.getElementById('cancel_restore').style.display='none';
    document.getElementById('are_you_sure').style.display='none';
}
function showDisable() {
    document.getElementById('disable').style.display='none';
    document.getElementById('cancel_disable').style.display='block';
    document.getElementById('are_you_sure').style.display='block';
}
function hideDisable() {
    document.getElementById('disable').style.display='block';
    document.getElementById('cancel_disable').style.display='none';
    document.getElementById('are_you_sure').style.display='none';
}
</script>
{% endblock %}

